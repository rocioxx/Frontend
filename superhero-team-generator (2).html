<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Generador de Equipos de Superhéroes</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          animation: {
            // Se mantiene la animación original
            'bounce-slow': 'bounce 2s infinite',
            'pulse-slow': 'pulse 3s infinite',
          }
        }
      }
    }
  </script>
</head>
<body class="min-h-screen bg-gradient-to-br from-cyan-600 via-blue-600 to-emerald-800 p-4">
  <div class="max-w-7xl mx-auto bg-white/95 backdrop-blur-sm rounded-3xl shadow-2xl p-6 md:p-8">
    <div class="text-center mb-8">
      <h1 class="text-4xl md:text-6xl font-bold bg-gradient-to-r from-cyan-600 to-emerald-500 bg-clip-text text-transparent mb-4">
        🦸‍♂️ Generador de Equipos 🦸‍♀️
      </h1>
      <p class="text-gray-600 text-lg">Crea y gestiona equipos épicos de superhéroes</p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
      <div class="bg-gradient-to-r from-sky-50 to-cyan-50 p-6 rounded-2xl border-2 border-sky-100 hover:shadow-lg transition-all duration-300">
        <h3 class="text-xl font-bold text-sky-700 mb-4 flex items-center">
          <span class="mr-2">📊</span> Gestión de Equipos
        </h3>
        <div class="space-y-3">
          <button onclick="generateRandomTeam()" 
                  class="w-full bg-gradient-to-r from-cyan-500 to-sky-500 hover:from-cyan-600 hover:to-sky-600 text-white font-bold py-3 px-4 rounded-xl transform hover:scale-105 transition-all duration-200 shadow-lg">
            🎲 Generar Equipo Aleatorio
          </button>
          <button onclick="analyzeCurrentTeam()" 
                  class="w-full bg-gradient-to-r from-teal-500 to-emerald-500 hover:from-teal-600 hover:to-emerald-600 text-white font-bold py-3 px-4 rounded-xl transform hover:scale-105 transition-all duration-200 shadow-lg">
            📈 Analizar Equipo
          </button>
          <button onclick="clearTeam()" 
                  class="w-full bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white font-bold py-3 px-4 rounded-xl transform hover:scale-105 transition-all duration-200 shadow-lg">
            🗑️ Limpiar Equipo
          </button>
        </div>
      </div>

      <div class="bg-gradient-to-r from-green-50 to-emerald-50 p-6 rounded-2xl border-2 border-green-100 hover:shadow-lg transition-all duration-300">
        <h3 class="text-xl font-bold text-emerald-700 mb-4 flex items-center">
          <span class="mr-2">🔍</span> Filtros
        </h3>
        <div class="space-y-3">
          <select id="powerFilter" onchange="filterHeroes()" 
                  class="w-full p-3 border-2 border-emerald-200 rounded-xl focus:border-emerald-400 focus:outline-none bg-white shadow-sm">
            <option value="">Todos los poderes</option>
            <option value="Fuerza">💪 Fuerza</option>
            <option value="Velocidad">⚡ Velocidad</option>
            <option value="Vuelo">🦅 Vuelo</option>
            <option value="Telepatía">🧠 Telepatía</option>
            <option value="Invisibilidad">👻 Invisibilidad</option>
          </select>
          <select id="levelFilter" onchange="filterHeroes()" 
                  class="w-full p-3 border-2 border-emerald-200 rounded-xl focus:border-emerald-400 focus:outline-none bg-white shadow-sm">
            <option value="">Todos los niveles</option>
            <option value="elite">👑 Élite (85+)</option> <option value="high">🔥 Alto (70-84)</option>
            <option value="medium">⚖️ Medio (50-69)</option>
            <option value="low">🌱 Bajo (0-49)</option>
          </select>
        </div>
      </div>

      <div class="bg-gradient-to-r from-indigo-50 to-blue-50 p-6 rounded-2xl border-2 border-indigo-100 hover:shadow-lg transition-all duration-300">
        <h3 class="text-xl font-bold text-indigo-700 mb-4 flex items-center">
          <span class="mr-2">⚡</span> Acciones Avanzadas
        </h3>
        <div class="space-y-3">
          <button onclick="findStrongestHero()" 
                  class="w-full bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600 text-white font-bold py-3 px-4 rounded-xl transform hover:scale-105 transition-all duration-200 shadow-lg">
            💪 Héroe Más Fuerte
          </button>
          <button onclick="createSuperTeam()" 
                  class="w-full bg-gradient-to-r from-teal-500 to-cyan-500 hover:from-teal-600 hover:to-cyan-600 text-white font-bold py-3 px-4 rounded-xl transform hover:scale-105 transition-all duration-200 shadow-lg">
            ⭐ Equipo Elite
          </button>
          <button onclick="showTeamStats()" 
                  class="w-full bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-600 hover:to-teal-600 text-white font-bold py-3 px-4 rounded-xl transform hover:scale-105 transition-all duration-200 shadow-lg">
            📊 Ver Estadísticas
          </button>
        </div>
      </div>
    </div>

    <div id="teamSummary" class="hidden mb-8">
      <div class="bg-gradient-to-r from-cyan-100 to-emerald-100 p-6 rounded-2xl border-2 border-cyan-200 shadow-lg">
        <div id="teamSummaryContent"></div>
      </div>
    </div>

    <div id="heroGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-8"></div>

    <div id="output" class="hidden">
      <div class="bg-gray-900 text-emerald-400 p-6 rounded-2xl font-mono shadow-2xl border border-gray-700">
        <div class="flex items-center mb-3">
          <div class="flex space-x-1">
            <div class="w-3 h-3 bg-red-500 rounded-full"></div>
            <div class="w-3 h-3 bg-yellow-500 rounded-full"></div>
            <div class="w-3 h-3 bg-green-500 rounded-full"></div>
          </div>
          <span class="ml-4 text-gray-400">Consola de Superhéroes</span>
        </div>
        <div id="outputContent" class="max-h-64 overflow-y-auto whitespace-pre-line"></div>
      </div>
    </div>
  </div>

  <script>
    const HERO_DATABASE = [
      { name: "Capitán Rayo", power: "Fuerza", level: 95, origin: "Tierra", weakness: "Kriptonita", emoji: "⚡" },
      { name: "Sombra Ninja", power: "Invisibilidad", level: 78, origin: "Japón", weakness: "Luz brillante", emoji: "🥷" },
      { name: "Flash Cósmico", power: "Velocidad", level: 88, origin: "Espacio", weakness: "Frío extremo", emoji: "💫" },
      { name: "Mente Maestra", power: "Telepatía", level: 82, origin: "Marte", weakness: "Metal", emoji: "🧠" },
      { name: "Águila Dorada", power: "Vuelo", level: 75, origin: "Atlántida", weakness: "Agua salada", emoji: "🦅" },
      { name: "Furia Titánica", power: "Fuerza", level: 99, origin: "Olimpo", weakness: "Amor verdadero", emoji: "💪" },
      { name: "Espectro Veloz", power: "Velocidad", level: 65, origin: "Dimensión X", weakness: "Gravedad", emoji: "👻" },
      { name: "Psíquico Supremo", power: "Telepatía", level: 89, origin: "Luna", weakness: "Emociones fuertes", emoji: "🌙" },
      { name: "Fantasma Plateado", power: "Invisibilidad", level: 71, origin: "Reino Fantasma", weakness: "Sal", emoji: "✨" },
      { name: "Halcón Estelar", power: "Vuelo", level: 86, origin: "Nebulosa", weakness: "Campos magnéticos", emoji: "🌟" }
    ];

    let currentTeam = [];
    let filteredHeroes = [...HERO_DATABASE];
    const TEAM_STORAGE_KEY = 'superheroTeam'; // Clave para LocalStorage

    const getRandomHero = () => HERO_DATABASE[Math.floor(Math.random() * HERO_DATABASE.length)];
    
    const generateTeamName = () => {
      const adjectives = ['Invencibles', 'Legendarios', 'Supremos', 'Élite', 'Cósmicos', 'Místicos', 'Galácticos'];
      const nouns = ['Guardianes', 'Vengadores', 'Protectores', 'Campeones', 'Defensores', 'Héroes', 'Titanes'];
      return `${adjectives[Math.floor(Math.random() * adjectives.length)]} ${nouns[Math.floor(Math.random() * nouns.length)]}`;
    };

    // --- FUNCIONES DE PERSISTENCIA ---
    const saveTeam = () => {
      localStorage.setItem(TEAM_STORAGE_KEY, JSON.stringify(currentTeam));
    };

    const loadTeam = () => {
      const storedTeam = localStorage.getItem(TEAM_STORAGE_KEY);
      if (storedTeam) {
        currentTeam = JSON.parse(storedTeam);
        showOutput(`💾 Equipo cargado con ${currentTeam.length} miembros`);
      } else {
        showOutput(`⭐ ¡Bienvenido! Crea tu primer equipo.`);
      }
    };
    // ----------------------------------

    // --- LÓGICA DE ESTILOS Y COMPONENTES ---
    const getLevelColors = (level) => {
      if (level >= 85) return { bg: 'from-purple-600 to-indigo-600', text: 'text-white', badge: 'bg-red-500' };
      if (level >= 70) return { bg: 'from-cyan-500 to-emerald-500', text: 'text-white', badge: 'bg-yellow-500' };
      return { bg: 'from-sky-500 to-cyan-500', text: 'text-white', badge: 'bg-green-500' };
    };

    const createHeroCard = (hero) => {
      const isInTeam = currentTeam.some(h => h.name === hero.name);
      const { bg } = getLevelColors(hero.level); 
      
      const borderColor = isInTeam ? 'border-purple-500 ring-4 ring-purple-200 animate-pulse-slow' : 'border-gray-200';

      return `
        <div class="bg-white rounded-2xl shadow-lg hover:shadow-2xl transform hover:scale-105 transition-all duration-300 ${borderColor} border-2 p-6 cursor-pointer group"
             onclick="toggleHeroInTeam('${hero.name}')">
          <div class="text-center mb-4">
            <div class="text-6xl mb-2 group-hover:animate-bounce-slow">${hero.emoji}</div>
            <h3 class="text-xl font-bold text-gray-800 mb-2">${hero.name}</h3>
            <span class="inline-block bg-gradient-to-r ${bg} text-white px-4 py-2 rounded-full font-bold text-sm shadow-md">
              Nivel ${hero.level}
            </span>
          </div>
          <div class="space-y-2 text-sm text-gray-600">
            <div class="flex justify-between">
              <span class="font-semibold">Poder:</span>
              <span class="text-cyan-600 font-bold">${hero.power}</span>
            </div>
            <div class="flex justify-between">
              <span class="font-semibold">Origen:</span>
              <span class="text-blue-600">${hero.origin}</span>
            </div>
            <div class="flex justify-between">
              <span class="font-semibold">Debilidad:</span>
              <span class="text-red-500">${hero.weakness}</span>
            </div>
          </div>
          <div class="mt-4 text-center">
            <button class="w-full bg-gradient-to-r from-teal-500 to-cyan-500 hover:from-teal-600 hover:to-cyan-600 text-white px-4 py-2 rounded-lg font-semibold transition-all duration-200 transform group-hover:scale-110">
              ${isInTeam ? '✅ En Equipo' : '➕ Añadir'}
            </button>
          </div>
        </div>
      `;
    };
    // ------------------------------------------------

    // --- LÓGICA DE GESTIÓN DE EQUIPO ---
    const toggleHeroInTeam = (heroName) => {
      const hero = HERO_DATABASE.find(h => h.name === heroName);
      const heroIndex = currentTeam.findIndex(h => h.name === heroName);

      if (heroIndex >= 0) {
        currentTeam = currentTeam.filter(h => h.name !== heroName);
        showOutput(`❌ ${heroName} removido del equipo`);
      } else {
        addHeroToTeam(hero);
      }
      saveTeam(); // Guardar después de modificar
      updateDisplay();
    };

    const addHeroToTeam = (hero) => {
      const heroExists = currentTeam.find(h => h.name === hero.name);
      if (!heroExists && currentTeam.length < 5) {
        currentTeam = [...currentTeam, hero];
        saveTeam(); // Guardar después de modificar
        updateDisplay();
        showOutput(`✅ ${hero.name} añadido al equipo!`);
      } else if (currentTeam.length >= 5) {
        showOutput(`❌ El equipo está completo (máximo 5 héroes)`);
      } else {
        showOutput(`❌ ${hero.name} ya está en el equipo`);
      }
    };

    const clearTeam = () => {
      currentTeam = [];
      localStorage.removeItem(TEAM_STORAGE_KEY);
      updateDisplay();
      document.getElementById('teamSummary').classList.add('hidden');
      showOutput(`🗑️ Equipo limpiado`);
    };

    const calculateTeamStats = () => {
      if (currentTeam.length === 0) return null;
      return currentTeam.reduce((stats, hero) => ({
        totalPower: stats.totalPower + hero.level,
        avgPower: Math.round((stats.totalPower + hero.level) / currentTeam.length),
        maxPower: Math.max(stats.maxPower, hero.level),
        minPower: Math.min(stats.minPower, hero.level),
        memberCount: currentTeam.length // Corregido: memberCount se calcula al final
      }), {
        totalPower: 0,
        avgPower: 0,
        maxPower: 0,
        minPower: 100
      });
    };
    // ------------------------------------

    // --- LÓGICA DE ACCIONES PRINCIPALES ---
    const generateRandomTeam = () => {
      currentTeam = [];
      const teamSize = Math.floor(Math.random() * 3) + 3;
      const usedHeroes = new Set();
      while (currentTeam.length < teamSize) {
        const randomHero = getRandomHero();
        if (!usedHeroes.has(randomHero.name)) {
          currentTeam = [...currentTeam, randomHero];
          usedHeroes.add(randomHero.name);
        }
      }
      const teamName = generateTeamName();
      saveTeam(); // Guardar equipo aleatorio
      updateDisplay();
      showOutput(`🎲 ¡Equipo "${teamName}" generado con ${currentTeam.length} miembros!`);
    };

    const createSuperTeam = () => {
      const topHeroes = HERO_DATABASE
        .filter(hero => hero.level >= 85)
        .sort((a, b) => b.level - a.level)
        .slice(0, 4);
      currentTeam = [...topHeroes];
      saveTeam(); // Guardar equipo elite
      updateDisplay();
      showOutput(`⭐ Equipo Elite creado con los ${currentTeam.length} héroes más poderosos (Nivel 85+)`);
    };

    const findStrongestHero = () => {
      // Buscar el héroe más fuerte sin añadirlo automáticamente (UX mejorada)
      const strongest = HERO_DATABASE.reduce((max, hero) => 
        (hero.level > max.level ? hero : max), { level: -1, name: "Nadie" });

      if (strongest.name !== "Nadie") {
        const {name, level, power} = strongest;
        showOutput(`💪 Héroe más fuerte encontrado: ${name} (Nivel ${level}, Poder: ${power}). ¡Añádelo con un click!`);
      }
    };
    
    const analyzeCurrentTeam = () => {
      if (currentTeam.length === 0) {
        showOutput(`❌ No hay equipo para analizar. Genera uno primero.`);
        return;
      }
      const stats = calculateTeamStats();
      const powers = currentTeam.map(hero => hero.power);
      const uniquePowers = [...new Set(powers)];
      const analysis = `📊 ANÁLISIS COMPLETO DEL EQUIPO:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
👥 Miembros: ${stats.memberCount}
⚡ Poder Total: ${stats.totalPower}
📈 Poder Promedio: ${stats.avgPower}
🏆 Máximo: ${stats.maxPower}
📉 Mínimo: ${stats.minPower}
🎯 Poderes únicos: ${uniquePowers.length} (${uniquePowers.join(', ')})

🏅 RANKING DEL EQUIPO:
${currentTeam
  .sort((a, b) => b.level - a.level)
  .map((hero, index) => `${index + 1}. ${hero.emoji} ${hero.name} (${hero.level})`)
  .join('\n')}`;
      showOutput(analysis);
    };

    const showTeamStats = () => {
      if (currentTeam.length === 0) {
        showOutput(`❌ No hay equipo actual`);
        return;
      }
      const stats = calculateTeamStats();
      const statsText = `📊 ESTADÍSTICAS DEL EQUIPO:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
👥 Miembros: ${stats.memberCount}
⚡ Poder Total: ${stats.totalPower}
📈 Promedio: ${stats.avgPower}
🏆 Nivel Máx: ${stats.maxPower}
📉 Nivel Mín: ${stats.minPower}`;
      showOutput(statsText);
    };
    // ------------------------------------
    
    // --- LÓGICA DE FILTROS ---
    const checkLevelRange = (level, range) => {
      switch(range) {
        case 'elite': return level >= 85; // Nuevo rango
        case 'high': return level >= 70 && level < 85;
        case 'medium': return level >= 50 && level < 70;
        case 'low': return level < 50;
        default: return true;
      }
    };

    const filterHeroes = () => {
      const powerFilter = document.getElementById('powerFilter').value;
      const levelFilter = document.getElementById('levelFilter').value;

      filteredHeroes = HERO_DATABASE.filter(hero => {
        const powerMatch = !powerFilter || hero.power === powerFilter;
        const levelMatch = !levelFilter || checkLevelRange(hero.level, levelFilter);
        return powerMatch && levelMatch;
      });

      updateDisplay();
      showOutput(`🔍 Filtrados: ${filteredHeroes.length} héroes encontrados`);
    };
    // ------------------------------------

    // --- LÓGICA DE VISUALIZACIÓN ---
    const showOutput = (message) => {
      const output = document.getElementById('output');
      const outputContent = document.getElementById('outputContent');
      output.classList.remove('hidden');
      outputContent.textContent = message;
    };

    const showTeamSummary = (teamName) => {
      const summary = document.getElementById('teamSummary');
      const content = document.getElementById('teamSummaryContent');
      const stats = calculateTeamStats();
      
      if (!stats || stats.memberCount === 0) { // Asegurar que se oculte si el equipo está vacío
          summary.classList.add('hidden');
          return;
      }
      
      // Detalle de miembros y barra de poder (max 500)
      const teamMates = currentTeam.map(h => `${h.emoji} ${h.name}`).join(' | ');
      const totalPowerBar = Math.min(100, Math.round(stats.totalPower / 500 * 100)); 

      summary.classList.remove('hidden');
      content.innerHTML = `
        <h3 class="text-2xl font-bold text-emerald-700 mb-4 flex items-center">
            <span class="mr-3">⭐</span> Equipo: ${teamName} 
            <span class="ml-auto text-xl text-gray-500">${stats.memberCount}/5</span>
        </h3>
        <div class="space-y-3">
            <div class="bg-gray-200 rounded-full h-4 mb-4" title="Poder Total: ${stats.totalPower}">
                <div class="bg-gradient-to-r from-teal-400 to-cyan-500 h-4 rounded-full transition-all duration-500" 
                     style="width: ${totalPowerBar}%"></div>
            </div>
            <p class="text-gray-700 font-semibold flex justify-between">
                <span>⚡ Poder Total:</span>
                <span class="text-teal-600 font-bold">${stats.totalPower}</span>
            </p>
            <p class="text-gray-700 flex justify-between">
                <span>📈 Promedio:</span>
                <span class="text-cyan-600">${stats.avgPower}</span>
            </p>
            <p class="text-gray-700 flex justify-between">
                <span>🏆 Nivel Máximo:</span>
                <span class="text-indigo-600">${stats.maxPower}</span>
            </p>
            <p class="mt-4 pt-4 border-t border-gray-300 text-sm overflow-x-auto whitespace-nowrap">
                **Miembros:** ${teamMates}
            </p>
        </div>
      `;
    };

    const updateDisplay = () => {
      const heroGrid = document.getElementById('heroGrid');
      heroGrid.innerHTML = filteredHeroes.map(createHeroCard).join('');
      // Mostrar el resumen del equipo con un nombre por defecto
      showTeamSummary(currentTeam.length > 0 ? 'Equipo Actual' : 'No hay equipo');
    };
    // ------------------------------------

    // --- PUNTO DE INICIO ---
    const initialize = () => {
        loadTeam();
        updateDisplay();
    };

    initialize();
  </script>
</body>
</html>